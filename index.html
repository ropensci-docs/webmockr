<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Stubbing and Setting Expectations on HTTP Requests • webmockr</title>
<!-- rOpenSci favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Stubbing and Setting Expectations on HTTP Requests">
<meta name="description" content="Stubbing and setting expectations on HTTP requests. Includes tools for stubbing HTTP requests, including expected request conditions and response conditions. Match on HTTP method, query parameters, request body, headers and more. Can be used for unit tests or outside of a testing context.">
<meta property="og:description" content="Stubbing and setting expectations on HTTP requests. Includes tools for stubbing HTTP requests, including expected request conditions and response conditions. Match on HTTP method, query parameters, request body, headers and more. Can be used for unit tests or outside of a testing context.">
<meta property="og:image" content="https://docs.ropensci.org/webmockr/logo.png">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css">
<script src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.umd.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="index.html">webmockr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.2.91</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/webmockr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="webmockr">webmockr<a class="anchor" aria-label="anchor" href="#webmockr"></a>
</h1>
</div>
<!-- NOTE: run `make readme` to generate the README.md -->
<p><a href="https://cloud.r-project.org/web/checks/check_results_webmockr.html" class="external-link"><img src="https://badges.cranchecks.info/worst/webmockr.svg" alt="cran checks"></a> <a href="https://www.repostatus.org/#active" class="external-link"><img src="https://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active - The project has reached a stable, usable state and is being actively developed."></a> <a href="https://github.com/ropensci/webmockr/actions/" class="external-link"><img src="https://github.com/ropensci/webmockr/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a> <a href="https://codecov.io/gh/ropensci/webmockr" class="external-link"><img src="https://codecov.io/gh/ropensci/webmockr/branch/main/graph/badge.svg?token=1zWlEQbaEh" alt="codecov"></a> <a href="https://github.com/r-hub/cranlogs.app" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/webmockr" alt="rstudio mirror downloads"></a> <a href="https://cran.r-project.org/package=webmockr" class="external-link"><img src="https://www.r-pkg.org/badges/version/webmockr" alt="cran version"></a></p>
<p>R library for stubbing and setting expectations on HTTP requests.</p>
<p>Port of the Ruby gem <a href="https://github.com/bblimke/webmock" class="external-link">webmock</a></p>
<details><summary><strong>How it works in detail</strong>
</summary><p>
</p>
<p>
The very very short version is: <code>webmockr</code> helps you stub HTTP requests so you don’t have to repeat yourself.
</p>
<p>
<strong>More details</strong>
</p>
<p>
You tell <code>webmockr</code> what HTTP request you want to match against and if it sees a request matching your criteria it doesn’t actually do the HTTP request. Instead, it gives back the same object you would have gotten back with a real request, but only with the bits it knows about. For example, we can’t give back the actual data you’d get from a real HTTP request as the request wasn’t performed.
</p>
<p>
In addition, if you set an expectation of what <code>webmockr</code> should return, we return that. For example, if you expect a request to return a 418 error (I’m a Teapot), then that’s what you’ll get.
</p>
<p>
<strong>What you can match against</strong>
</p>
<ul>
<li>
HTTP method (required)
</li>
</ul>
<p>
Plus any single or combination of the following:
</p>
<ul>
<li>
URI
<ul>
<li>
Right now, we can match directly against URI’s, and with regex URI patterns. Eventually, we will support RFC 6570 URI templates.
</li>
<li>
We normalize URI paths so that URL encoded things match URL un-encoded things (e.g. <code>hello world</code> to <code>hello%20world</code>)
</li>
</ul>
</li>
<li>
Query parameters
<ul>
<li>
We normalize query parameter values so that URL encoded things match URL un-encoded things (e.g. <code>message = hello world</code> to <code>message = hello%20world</code>)
</li>
</ul>
</li>
<li>
Request headers
<ul>
<li>
We normalize headers and treat all forms of same headers as equal. For example, the following two sets of headers are equal:
<ul>
<li>
<code>list(H1 = "value1", content_length = 123, X_CuStOm_hEAder = "foo")</code>
</li>
<li>
<code>list(h1 = "value1", "Content-Length" = 123, "x-cuSTOM-HeAder" = "foo")</code>
</li>
</ul>
</li>
</ul>
</li>
<li>
Request body
</li>
</ul>
<p>
<strong>Real HTTP requests</strong>
</p>
<p>
There’s a few scenarios to think about when using <code>webmockr</code>:
</p>
<p>
After doing
</p>
<pre class="r"><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/webmockr">webmockr</a></span><span class="op">)</span></span></code></pre>
<p>
<code>webmockr</code> is loaded but not turned on. At this point <code>webmockr</code> doesn’t change anythning.
</p>
<p>
Once you turn on <code>webmockr</code> like
</p>
<pre class="r"><code><span><span class="fu">webmockr</span><span class="fu">::</span><span class="fu"><a href="reference/enable.html">enable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>
<code>webmockr</code> will now by default not allow real HTTP requests from the http libraries that adapters are loaded for (right now only <code>crul</code>).
</p>
<p>
You can optionally allow real requests via <code><a href="reference/webmockr_configure.html">webmockr_allow_net_connect()</a></code>, and disallow real requests via <code><a href="reference/webmockr_configure.html">webmockr_disable_net_connect()</a></code>. You can check whether you are allowing real requests with <code><a href="reference/webmockr_configure.html">webmockr_net_connect_allowed()</a></code>.
</p>
<p>
Certain kinds of real HTTP requests allowed: We don’t suppoprt this yet, but you can allow localhost HTTP requests with the <code>allow_localhost</code> parameter in the <code><a href="reference/webmockr_configure.html">webmockr_configure()</a></code> function.
</p>
<p>
<strong>Storing actual HTTP responses</strong>
</p>
<p>
<code>webmockr</code> doesn’t do that. Check out <a href="https://github.com/ropensci/vcr" class="external-link">vcr</a>
</p>

</details><div class="section level2">
<h2 id="features">Features<a class="anchor" aria-label="anchor" href="#features"></a>
</h2>
<ul>
<li>Stubbing HTTP requests at low http client lib level</li>
<li>Setting and verifying expectations on HTTP requests</li>
<li>Matching requests based on method, URI, headers and body</li>
<li>Support for <code>testthat</code> via <a href="https://github.com/ropensci/vcr" class="external-link">vcr</a>
</li>
<li>Can be used for testing or outside of a testing context</li>
<li>Supports async http request mocking with <code>crul</code> only</li>
</ul>
</div>
<div class="section level2">
<h2 id="supported-http-libraries">Supported HTTP libraries<a class="anchor" aria-label="anchor" href="#supported-http-libraries"></a>
</h2>
<ul>
<li><a href="https://github.com/ropensci/crul" class="external-link">crul</a></li>
<li><a href="https://github.com/r-lib/httr" class="external-link">httr</a></li>
<li><a href="https://github.com/r-lib/httr2" class="external-link">httr2</a></li>
</ul>
</div>
<div class="section level2">
<h2 id="install">Install<a class="anchor" aria-label="anchor" href="#install"></a>
</h2>
<p>from cran</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"webmockr"</span><span class="op">)</span></span></code></pre></div>
<p>Dev version</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu">pak</span><span class="op">(</span><span class="st">"ropensci/webmockr"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/webmockr">webmockr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="enable-webmockr">Enable webmockr<a class="anchor" aria-label="anchor" href="#enable-webmockr"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">webmockr</span><span class="fu">::</span><span class="fu"><a href="reference/enable.html">enable</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; CrulAdapter enabled!</span></span>
<span><span class="co">#&gt; HttrAdapter enabled!</span></span>
<span><span class="co">#&gt; Httr2Adapter enabled!</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="inside-a-test-framework">Inside a test framework<a class="anchor" aria-label="anchor" href="#inside-a-test-framework"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/crul/" class="external-link">crul</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org" class="external-link">testthat</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make a stub</span></span>
<span><span class="fu"><a href="reference/stub_request.html">stub_request</a></span><span class="op">(</span><span class="st">"get"</span>, <span class="st">"https://httpbin.org/get"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="reference/to_return.html">to_return</a></span><span class="op">(</span>body <span class="op">=</span> <span class="st">"success!"</span>, status <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;webmockr stub&gt; </span></span>
<span><span class="co">#&gt;   method: get</span></span>
<span><span class="co">#&gt;   uri: https://httpbin.org/get</span></span>
<span><span class="co">#&gt;   with: </span></span>
<span><span class="co">#&gt;     query: </span></span>
<span><span class="co">#&gt;     body: </span></span>
<span><span class="co">#&gt;     request_headers: </span></span>
<span><span class="co">#&gt;   to_return: </span></span>
<span><span class="co">#&gt;   - status: 200</span></span>
<span><span class="co">#&gt;     body: success!</span></span>
<span><span class="co">#&gt;     response_headers: </span></span>
<span><span class="co">#&gt;     should_timeout: FALSE</span></span>
<span><span class="co">#&gt;     should_raise: FALSE</span></span>
<span></span>
<span><span class="co"># check that it's in the stub registry</span></span>
<span><span class="fu"><a href="reference/stub_registry.html">stub_registry</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;webmockr stub registry&gt; </span></span>
<span><span class="co">#&gt;  Registered Stubs</span></span>
<span><span class="co">#&gt;    GET: https://httpbin.org/get    | to_return:   with body "success!"  with status 200</span></span>
<span></span>
<span><span class="co"># make the request</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">crul</span><span class="fu">::</span><span class="va"><a href="https://docs.ropensci.org/crul/reference/HttpClient.html" class="external-link">HttpClient</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://httpbin.org"</span><span class="op">)</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"get"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run tests (nothing returned means it passed)</span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/expect_is.html" class="external-link">expect_is</a></span><span class="op">(</span><span class="va">z</span>, <span class="st">"HttpResponse"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html" class="external-link">expect_equal</a></span><span class="op">(</span><span class="va">z</span><span class="op">$</span><span class="va">status_code</span>, <span class="fl">200</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html" class="external-link">expect_equal</a></span><span class="op">(</span><span class="va">z</span><span class="op">$</span><span class="fu">parse</span><span class="op">(</span><span class="st">"UTF-8"</span><span class="op">)</span>, <span class="st">"success!"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="outside-a-test-framework">Outside a test framework<a class="anchor" aria-label="anchor" href="#outside-a-test-framework"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/crul/" class="external-link">crul</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="stubbed-request-based-on-uri-only-and-with-the-default-response">Stubbed request based on uri only and with the default response<a class="anchor" aria-label="anchor" href="#stubbed-request-based-on-uri-only-and-with-the-default-response"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/stub_request.html">stub_request</a></span><span class="op">(</span><span class="st">"get"</span>, <span class="st">"https://httpbin.org/get"</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;webmockr stub&gt; </span></span>
<span><span class="co">#&gt;   method: get</span></span>
<span><span class="co">#&gt;   uri: https://httpbin.org/get</span></span>
<span><span class="co">#&gt;   with: </span></span>
<span><span class="co">#&gt;     query: </span></span>
<span><span class="co">#&gt;     body: </span></span>
<span><span class="co">#&gt;     request_headers: </span></span>
<span><span class="co">#&gt;   to_return:</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va"><a href="https://docs.ropensci.org/crul/reference/HttpClient.html" class="external-link">HttpClient</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://httpbin.org"</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">'get'</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;crul response&gt; </span></span>
<span><span class="co">#&gt;   url: https://httpbin.org/get</span></span>
<span><span class="co">#&gt;   request_headers: </span></span>
<span><span class="co">#&gt;     User-Agent: libcurl/8.7.1 r-curl/5.2.1 crul/1.5.0</span></span>
<span><span class="co">#&gt;     Accept-Encoding: gzip, deflate</span></span>
<span><span class="co">#&gt;     Accept: application/json, text/xml, application/xml, */*</span></span>
<span><span class="co">#&gt;   response_headers: </span></span>
<span><span class="co">#&gt;   status: 200</span></span></code></pre></div>
<p>set return objects</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/stub_request.html">stub_request</a></span><span class="op">(</span><span class="st">"get"</span>, <span class="st">"https://httpbin.org/get"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/wi_th.html">wi_th</a></span><span class="op">(</span></span>
<span>    query <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>hello <span class="op">=</span> <span class="st">"world"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="reference/to_return.html">to_return</a></span><span class="op">(</span>status <span class="op">=</span> <span class="fl">418</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;webmockr stub&gt; </span></span>
<span><span class="co">#&gt;   method: get</span></span>
<span><span class="co">#&gt;   uri: https://httpbin.org/get</span></span>
<span><span class="co">#&gt;   with: </span></span>
<span><span class="co">#&gt;     query: hello=world</span></span>
<span><span class="co">#&gt;     body: </span></span>
<span><span class="co">#&gt;     request_headers: </span></span>
<span><span class="co">#&gt;   to_return: </span></span>
<span><span class="co">#&gt;   - status: 418</span></span>
<span><span class="co">#&gt;     body: </span></span>
<span><span class="co">#&gt;     response_headers: </span></span>
<span><span class="co">#&gt;     should_timeout: FALSE</span></span>
<span><span class="co">#&gt;     should_raise: FALSE</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">'get'</span>, query <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>hello <span class="op">=</span> <span class="st">"world"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;crul response&gt; </span></span>
<span><span class="co">#&gt;   url: https://httpbin.org/get</span></span>
<span><span class="co">#&gt;   request_headers: </span></span>
<span><span class="co">#&gt;     User-Agent: libcurl/8.7.1 r-curl/5.2.1 crul/1.5.0</span></span>
<span><span class="co">#&gt;     Accept-Encoding: gzip, deflate</span></span>
<span><span class="co">#&gt;     Accept: application/json, text/xml, application/xml, */*</span></span>
<span><span class="co">#&gt;   response_headers: </span></span>
<span><span class="co">#&gt;   status: 418</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="stubbing-requests-based-on-method-uri-and-query-params">Stubbing requests based on method, uri and query params<a class="anchor" aria-label="anchor" href="#stubbing-requests-based-on-method-uri-and-query-params"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/stub_request.html">stub_request</a></span><span class="op">(</span><span class="st">"get"</span>, <span class="st">"https://httpbin.org/get"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/wi_th.html">wi_th</a></span><span class="op">(</span>query <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>hello <span class="op">=</span> <span class="st">"world"</span><span class="op">)</span>, </span>
<span>        headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'User-Agent'</span> <span class="op">=</span> <span class="st">'libcurl/7.51.0 r-curl/2.6 crul/0.3.6'</span>, </span>
<span>                       <span class="st">'Accept-Encoding'</span> <span class="op">=</span> <span class="st">"gzip, deflate"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;webmockr stub&gt; </span></span>
<span><span class="co">#&gt;   method: get</span></span>
<span><span class="co">#&gt;   uri: https://httpbin.org/get</span></span>
<span><span class="co">#&gt;   with: </span></span>
<span><span class="co">#&gt;     query: hello=world</span></span>
<span><span class="co">#&gt;     body: </span></span>
<span><span class="co">#&gt;     request_headers: User-Agent=libcurl/7.51.0 r-cur..., Accept-Encoding=gzip, deflate</span></span>
<span><span class="co">#&gt;   to_return:</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/stub_registry.html">stub_registry</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;webmockr stub registry&gt; </span></span>
<span><span class="co">#&gt;  Registered Stubs</span></span>
<span><span class="co">#&gt;    GET: https://httpbin.org/get </span></span>
<span><span class="co">#&gt;    GET: https://httpbin.org/get  with query params hello=world   | to_return:    with status 418 </span></span>
<span><span class="co">#&gt;    GET: https://httpbin.org/get  with query params hello=world   with headers {"User-Agent":"libcurl/7.51.0 r-curl/2.6 crul/0.3.6","Accept-Encoding":"gzip, deflate"}</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va"><a href="https://docs.ropensci.org/crul/reference/HttpClient.html" class="external-link">HttpClient</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://httpbin.org"</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">'get'</span>, query <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>hello <span class="op">=</span> <span class="st">"world"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;crul response&gt; </span></span>
<span><span class="co">#&gt;   url: https://httpbin.org/get</span></span>
<span><span class="co">#&gt;   request_headers: </span></span>
<span><span class="co">#&gt;     User-Agent: libcurl/8.7.1 r-curl/5.2.1 crul/1.5.0</span></span>
<span><span class="co">#&gt;     Accept-Encoding: gzip, deflate</span></span>
<span><span class="co">#&gt;     Accept: application/json, text/xml, application/xml, */*</span></span>
<span><span class="co">#&gt;   response_headers: </span></span>
<span><span class="co">#&gt;   status: 418</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="stubbing-requests-and-set-expectation-of-a-timeout">Stubbing requests and set expectation of a timeout<a class="anchor" aria-label="anchor" href="#stubbing-requests-and-set-expectation-of-a-timeout"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/stub_request.html">stub_request</a></span><span class="op">(</span><span class="st">"post"</span>, <span class="st">"https://httpbin.org/post"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="reference/to_timeout.html">to_timeout</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;webmockr stub&gt; </span></span>
<span><span class="co">#&gt;   method: post</span></span>
<span><span class="co">#&gt;   uri: https://httpbin.org/post</span></span>
<span><span class="co">#&gt;   with: </span></span>
<span><span class="co">#&gt;     query: </span></span>
<span><span class="co">#&gt;     body: </span></span>
<span><span class="co">#&gt;     request_headers: </span></span>
<span><span class="co">#&gt;   to_return: </span></span>
<span><span class="co">#&gt;   - status: </span></span>
<span><span class="co">#&gt;     body: </span></span>
<span><span class="co">#&gt;     response_headers: </span></span>
<span><span class="co">#&gt;     should_timeout: TRUE</span></span>
<span><span class="co">#&gt;     should_raise: FALSE</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va"><a href="https://docs.ropensci.org/crul/reference/HttpClient.html" class="external-link">HttpClient</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://httpbin.org"</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="fu">post</span><span class="op">(</span><span class="st">'post'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Request Timeout (HTTP 408).</span></span>
<span><span class="co">#&gt;  - The client did not produce a request within the time that the server was prepared to wait. The client MAY repeat the request without modifications at any later time.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="stubbing-requests-and-set-http-error-expectation">Stubbing requests and set HTTP error expectation<a class="anchor" aria-label="anchor" href="#stubbing-requests-and-set-http-error-expectation"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sckott.github.io/fauxpas/" class="external-link">fauxpas</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/stub_request.html">stub_request</a></span><span class="op">(</span><span class="st">"get"</span>, <span class="st">"https://httpbin.org/get?a=b"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="reference/to_raise.html">to_raise</a></span><span class="op">(</span><span class="va">HTTPBadRequest</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;webmockr stub&gt; </span></span>
<span><span class="co">#&gt;   method: get</span></span>
<span><span class="co">#&gt;   uri: https://httpbin.org/get?a=b</span></span>
<span><span class="co">#&gt;   with: </span></span>
<span><span class="co">#&gt;     query: </span></span>
<span><span class="co">#&gt;     body: </span></span>
<span><span class="co">#&gt;     request_headers: </span></span>
<span><span class="co">#&gt;   to_return: </span></span>
<span><span class="co">#&gt;   - status: </span></span>
<span><span class="co">#&gt;     body: </span></span>
<span><span class="co">#&gt;     response_headers: </span></span>
<span><span class="co">#&gt;     should_timeout: FALSE</span></span>
<span><span class="co">#&gt;     should_raise: HTTPBadRequest</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va"><a href="https://docs.ropensci.org/crul/reference/HttpClient.html" class="external-link">HttpClient</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://httpbin.org"</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">'get'</span>, query <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Bad Request (HTTP 400).</span></span>
<span><span class="co">#&gt;  - The request could not be understood by the server due to malformed syntax. The client SHOULD NOT repeat the request without modifications.</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="httr-integration">httr integration<a class="anchor" aria-label="anchor" href="#httr-integration"></a>
</h2>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/webmockr">webmockr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://httr.r-lib.org/" class="external-link">httr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'httr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:crul':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     handle</span></span>
<span></span>
<span><span class="co"># turn on httr mocking</span></span>
<span><span class="fu"><a href="reference/httr_mock.html">httr_mock</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># no stub found</span></span>
<span><span class="fu"><a href="https://httr.r-lib.org/reference/GET.html" class="external-link">GET</a></span><span class="op">(</span><span class="st">"https://httpbin.org/get"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Real HTTP connections are disabled.</span></span>
<span><span class="co">#&gt; Unregistered request:</span></span>
<span><span class="co">#&gt;   GET https://httpbin.org/get   with headers {Accept: application/json, text/xml, application/xml, */*}</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; You can stub this request with the following snippet:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    stub_request('get', uri = 'https://httpbin.org/get') %&gt;%</span></span>
<span><span class="co">#&gt;      wi_th(</span></span>
<span><span class="co">#&gt;        headers = list('Accept' = 'application/json, text/xml, application/xml, */*')</span></span>
<span><span class="co">#&gt;      )</span></span>
<span><span class="co">#&gt; ============================================================</span></span></code></pre></div>
<p>make a stub</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/stub_request.html">stub_request</a></span><span class="op">(</span><span class="st">'get'</span>, uri <span class="op">=</span> <span class="st">'https://httpbin.org/get'</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/wi_th.html">wi_th</a></span><span class="op">(</span></span>
<span>    headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'Accept'</span> <span class="op">=</span> <span class="st">'application/json, text/xml, application/xml, */*'</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/to_return.html">to_return</a></span><span class="op">(</span>status <span class="op">=</span> <span class="fl">418</span>, body <span class="op">=</span> <span class="st">"I'm a teapot!!!"</span>, headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>im_a <span class="op">=</span> <span class="st">"teapot"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;webmockr stub&gt; </span></span>
<span><span class="co">#&gt;   method: get</span></span>
<span><span class="co">#&gt;   uri: https://httpbin.org/get</span></span>
<span><span class="co">#&gt;   with: </span></span>
<span><span class="co">#&gt;     query: </span></span>
<span><span class="co">#&gt;     body: </span></span>
<span><span class="co">#&gt;     request_headers: Accept=application/json, te...</span></span>
<span><span class="co">#&gt;   to_return: </span></span>
<span><span class="co">#&gt;   - status: 418</span></span>
<span><span class="co">#&gt;     body: I'm a teapot!!!</span></span>
<span><span class="co">#&gt;     response_headers: im_a=teapot</span></span>
<span><span class="co">#&gt;     should_timeout: FALSE</span></span>
<span><span class="co">#&gt;     should_raise: FALSE</span></span></code></pre></div>
<p>now returns mocked response</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr.r-lib.org/reference/GET.html" class="external-link">GET</a></span><span class="op">(</span><span class="st">"https://httpbin.org/get"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">status_code</span></span>
<span><span class="co">#&gt; [1] 418</span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">headers</span></span>
<span><span class="co">#&gt; $im_a</span></span>
<span><span class="co">#&gt; [1] "teapot"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="httr2-integration">httr2 integration<a class="anchor" aria-label="anchor" href="#httr2-integration"></a>
</h2>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/webmockr">webmockr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://httr2.r-lib.org" class="external-link">httr2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># turn on httr2 mocking</span></span>
<span><span class="fu"><a href="reference/enable.html">enable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># no stub found</span></span>
<span><span class="va">req</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr2.r-lib.org/reference/request.html" class="external-link">request</a></span><span class="op">(</span><span class="st">"https://hb.opencpu.org/get"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html" class="external-link">req_perform</a></span><span class="op">(</span><span class="va">req</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Real HTTP connections are disabled.</span></span>
<span><span class="co">#&gt; Unregistered request:</span></span>
<span><span class="co">#&gt;   GET https://hb.opencpu.org/get</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; You can stub this request with the following snippet:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    stub_request('get', uri = 'https://hb.opencpu.org/get')</span></span>
<span><span class="co">#&gt; ============================================================</span></span></code></pre></div>
<p>make a stub</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/stub_request.html">stub_request</a></span><span class="op">(</span><span class="st">'get'</span>, uri <span class="op">=</span> <span class="st">'https://hb.opencpu.org/get'</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/to_return.html">to_return</a></span><span class="op">(</span>status <span class="op">=</span> <span class="fl">418</span>, body <span class="op">=</span> <span class="st">"I'm a teapot!!!"</span>, headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>im_a <span class="op">=</span> <span class="st">"teapot"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;webmockr stub&gt; </span></span>
<span><span class="co">#&gt;   method: get</span></span>
<span><span class="co">#&gt;   uri: https://hb.opencpu.org/get</span></span>
<span><span class="co">#&gt;   with: </span></span>
<span><span class="co">#&gt;     query: </span></span>
<span><span class="co">#&gt;     body: </span></span>
<span><span class="co">#&gt;     request_headers: </span></span>
<span><span class="co">#&gt;   to_return: </span></span>
<span><span class="co">#&gt;   - status: 418</span></span>
<span><span class="co">#&gt;     body: I'm a teapot!!!</span></span>
<span><span class="co">#&gt;     response_headers: im_a=teapot</span></span>
<span><span class="co">#&gt;     should_timeout: FALSE</span></span>
<span><span class="co">#&gt;     should_raise: FALSE</span></span></code></pre></div>
<p>now returns mocked response</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">req</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr2.r-lib.org/reference/request.html" class="external-link">request</a></span><span class="op">(</span><span class="st">"https://hb.opencpu.org/get"</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html" class="external-link">req_perform</a></span><span class="op">(</span><span class="va">req</span><span class="op">)</span></span>
<span><span class="va">res</span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">status_code</span></span>
<span><span class="co">#&gt; [1] 418</span></span>
<span><span class="va">res</span><span class="op">$</span><span class="va">headers</span></span>
<span><span class="co">#&gt; &lt;httr2_headers/list&gt;</span></span>
<span><span class="co">#&gt; im_a: teapot</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="writing-to-disk">Writing to disk<a class="anchor" aria-label="anchor" href="#writing-to-disk"></a>
</h2>
<p>Write to a file before mocked request</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## make a temp file</span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".json"</span><span class="op">)</span></span>
<span><span class="co">## write something to the file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"{\"hello\":\"world\"}\n"</span>, file <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "{\"hello\":\"world\"}"</span></span>
<span><span class="co">## make the stub</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="reference/stub_request.html">stub_request</a></span><span class="op">(</span><span class="st">"get"</span>, <span class="st">"https://httpbin.org/get"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="reference/to_return.html">to_return</a></span><span class="op">(</span>body <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">file</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## make a request</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="va"><a href="https://docs.ropensci.org/crul/reference/HttpClient.html" class="external-link">HttpClient</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"https://httpbin.org/get"</span><span class="op">)</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span>disk <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">file</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "{\"hello\":\"world\"}"</span></span></code></pre></div>
<p>OR - you can use <code><a href="reference/mock_file.html">mock_file()</a></code> to have <code>webmockr</code> handle file and contents</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".json"</span><span class="op">)</span></span>
<span><span class="co">## make the stub</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="reference/stub_request.html">stub_request</a></span><span class="op">(</span><span class="st">"get"</span>, <span class="st">"https://httpbin.org/get"</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="reference/to_return.html">to_return</a></span><span class="op">(</span>body <span class="op">=</span> <span class="fu"><a href="reference/mock_file.html">mock_file</a></span><span class="op">(</span><span class="va">g</span>, <span class="st">"{\"hello\":\"mars\"}\n"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## make a request</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">crul</span><span class="fu">::</span><span class="va"><a href="https://docs.ropensci.org/crul/reference/HttpClient.html" class="external-link">HttpClient</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"https://httpbin.org/get"</span><span class="op">)</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span>disk <span class="op">=</span> <span class="va">g</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">content</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "{\"hello\":\"world\"}"</span></span></code></pre></div>
<p>Writing to disk is supported in <code>crul</code>, <code>httr</code>, and <code>httr2</code></p>
</div>
<div class="section level2">
<h2 id="many-requests-in-a-row">Many requests in a row<a class="anchor" aria-label="anchor" href="#many-requests-in-a-row"></a>
</h2>
<p>e.g., many redirects, then a final successful request</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">webmockr</span><span class="fu">::</span><span class="fu"><a href="reference/enable.html">enable</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/crul/" class="external-link">crul</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sckott.github.io/fauxpas/" class="external-link">fauxpas</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/stub_request.html">stub_request</a></span><span class="op">(</span><span class="st">"get"</span>, <span class="st">"https://httpbin.org/get"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/to_return.html">to_return</a></span><span class="op">(</span><span class="va">z</span>, status <span class="op">=</span> <span class="fl">200</span>, body <span class="op">=</span> <span class="st">"foobar"</span>, headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/to_return.html">to_return</a></span><span class="op">(</span><span class="va">z</span>, status <span class="op">=</span> <span class="fl">200</span>, body <span class="op">=</span> <span class="st">"bears"</span>, headers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/to_raise.html">to_raise</a></span><span class="op">(</span><span class="va">z</span>, <span class="va">HTTPBadRequest</span><span class="op">)</span></span>
<span><span class="va">z</span></span>
<span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">crul</span><span class="fu">::</span><span class="va"><a href="https://docs.ropensci.org/crul/reference/HttpClient.html" class="external-link">HttpClient</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://httpbin.org"</span><span class="op">)</span></span>
<span><span class="co"># the first to_return()</span></span>
<span><span class="va">first</span> <span class="op">&lt;-</span> <span class="va">con</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"get"</span><span class="op">)</span></span>
<span><span class="va">first</span></span>
<span><span class="va">first</span><span class="op">$</span><span class="fu">parse</span><span class="op">(</span><span class="st">"UTF-8"</span><span class="op">)</span></span>
<span><span class="co"># the second to_return()</span></span>
<span><span class="va">second</span> <span class="op">&lt;-</span> <span class="va">con</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"get"</span><span class="op">)</span></span>
<span><span class="va">second</span></span>
<span><span class="va">second</span><span class="op">$</span><span class="fu">parse</span><span class="op">(</span><span class="st">"UTF-8"</span><span class="op">)</span></span>
<span><span class="co"># the third to_return() - fails as specified</span></span>
<span><span class="va">third</span> <span class="op">&lt;-</span> <span class="va">con</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"get"</span><span class="op">)</span></span></code></pre></div>
<p>Note that subsequent requests past the number of responses given with <code><a href="reference/to_return.html">to_return()</a></code>/etc. simply gives the last response you specified. Although if you set a <code>to_timeout</code> or <code>to_raise</code> this feature won’t happen since you fail out.</p>
</div>
<div class="section level2">
<h2 id="contributors">Contributors<a class="anchor" aria-label="anchor" href="#contributors"></a>
</h2>
<ul>
<li><a href="https://github.com/sckott" class="external-link">Scott Chamberlain</a></li>
<li><a href="https://github.com/aaronwolen" class="external-link">Aaron Wolen</a></li>
</ul>
</div>
<div class="section level2">
<h2 id="meta">Meta<a class="anchor" aria-label="anchor" href="#meta"></a>
</h2>
<ul>
<li>Please <a href="https://github.com/ropensci/webmockr/issues" class="external-link">report any issues or bugs</a>.</li>
<li>License: MIT</li>
<li>Get citation information for <code>webmockr</code> in R doing <code>citation(package = 'webmockr')</code>
</li>
<li>Please note that this package is released with a <a href="https://ropensci.org/code-of-conduct/" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=webmockr" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/ropensci/webmockr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/ropensci/webmockr/issues" class="external-link">Report a bug</a></li>
</ul>
</div>



<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing webmockr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://scottchamberlain.info/" class="external-link">Scott Chamberlain</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-1444-9135" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://ropensci.org" class="external-link"><img src="https://github.com/ropensci.png" height="24"></a> <br><small class="roles"> Funder </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="r-universe">
<h2 data-toc-skip>R-universe</h2>
<ul class="list-unstyled">
<li><p><a href="https://ropensci.r-universe.dev/webmockr" class="external-link"><img src="https://ropensci.r-universe.dev/badges/webmockr" alt="webmockr status badge"></a></p></li>
</ul>
</div>

  </aside>
</div>


    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>





  </body>
</html>
